<!DOCTYPE html>
<html lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="css/all.css" rel="stylesheet"/>
    <script src="js/leader-line.min.js"></script>
</head>
<body>
    <div>
        <table>
            <tr>
                <td>Number of Symbols: </td>
                <td><input type="number" value="1" id="symbolNumber"><br/></td>
            </tr>
            <tr>
                <td>Symbols: </td>
                <td id="symbolInput"><input type="text" class="symbol"></td>
            </tr>
            <tr>
                <td>Start With: </td>
                <td>
                    <input type="text" class="start"><br/>
                    or, <input type="text" class="start">
                </td>
            </tr>
            <tr>
                <td>Contains: </td>
                <td>
                    <input type="text" class="contain"><br/>
                    or, <input type="text" class="contain">
                </td>
            </tr>
            <tr>
                <td>End With: </td>
                <td>
                    <input type="text" class="end"><br/>
                    or, <input type="text" class="end">
                </td>
            </tr>
        </table>
        <button id="generate">Generate NFA</button>
    </div>
    <style>
        * {
            box-sizing: border-box;
        }
        .stateContainer {
            display: inline-block;
            vertical-align: middle;
            margin: 5px 20px;
        }
        .state {
            width: 50px;
            height: 50px;
            border-radius: 50px;
            text-align: center;
            border: #000000 solid 2px;
            line-height: 42px;
            margin: 20px 5px;
            position: relative;
        }
        .initial {
            width: 10px;
            height: 200px;
            display: inline-block;
            margin: 5px 20px;
            vertical-align: middle;
        }
        .final {
            border: #000000 double 6px;
            line-height: 36px;
        }
        .captionTop {
            position: absolute;
            width: 1px;
            left: 25px;
            top: -30px;
            background-color: red;
        }
        .captionBottom {
            position: absolute;
            width: 1px;
            left: 25px;
            bottom: -30px;
            background-color: red;
        }
        #result {
            max-width: 100%;
            white-space: nowrap;
        }
    </style>
    <div id="result">
    </div>
    <script>
        var lines = [];

        symbolNumber.onchange = function(e) {
            var n = parseInt(e.target.value);
            symbolInput.innerHTML = "";

            for(i=1; i<=n; i++) {
                symbolInput.innerHTML += `<input type="text" class="symbol">  `;
            }
            console.log(e);
        } 

        generate.onclick = function() {
            lines.forEach(element => {
                element.remove()
            });

            lines = [];

            var lineIndex = 0;
            var totalState = 0;

            var start = document.getElementsByClassName("start");
            var maxStart = start[0].value.length > start[1].value.length ? 0 : 1;

            var contain = document.getElementsByClassName("contain");
            var maxContain = contain[0].value.length > contain[1].value.length ? 0 : 1;
            
            var end = document.getElementsByClassName("end");
            var maxEnd = end[0].value.length > end[1].value.length ? 0 : 1;

            var string = start[maxStart].value+contain.value+end.value;
            var startString = [start[0].value, start[1].value];
            var containString = [contain[0].value, contain[1].value];
            var endString = [end[0].value, end[1].value];

            var symbols = document.getElementsByClassName("symbol");
            var loopText = '';
            for(i=0; i<symbols.length; i++) {
                if(i!=0) {
                    loopText += ', ';
                }
                loopText += symbols[i].value;
            }

            result.innerHTML = `
            <div class="initial" id="qS"></div>
            <div class="stateContainer">
                <div class="state" id="q${totalState}">
                    q<sub>${totalState}</sub>
                </div>
            </div>
            `;
            totalState++;

            
            lines[lineIndex] = new LeaderLine(
                document.getElementById('qS'),
                document.getElementById('q0'), 
                {color: 'black', size: 2, path: 'straight'}
            );
            lineIndex++;

            var prevState = ['q0'];
            
            for(i=0; i<start[maxStart].value.length; i++) {
                if(start[0].value.charAt(i) == start[1].value.charAt(i) || start[0].value.charAt(i) == '' || start[1].value.charAt(i) == '') {
                    result.innerHTML += `
                    <div class="stateContainer">
                        <div class="state" id="q${totalState}">
                            q<sub>${totalState}</sub>
                        </div>
                    </div>
                    `;
                    if(prevState.length == 1) {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(startString[maxStart].charAt(i))}
                        );
                        lineIndex++;
                    }
                    else {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(startString[maxStart].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[1]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(startString[1].charAt(i))}
                        );
                        lineIndex++;
                    }
                    prevState = [`q${totalState}`];
                    totalState++;
                }
                else {
                    result.innerHTML += `
                    <div class="stateContainer">
                        <div class="state" id="q${totalState}">
                            q<sub>${totalState}</sub>
                        </div>
                        <div class="state" id="q${totalState+1}">
                            q<sub>${totalState+1}</sub>
                        </div>
                    </div>
                    `;

                    if(prevState.length == 1) {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(startString[0].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState+1}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(startString[1].charAt(i))}
                        );
                        lineIndex++;
                    }
                    else {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(startString[0].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[1]),
                            document.getElementById(`q${totalState+1}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(startString[1].charAt(i))}
                        );
                        lineIndex++;
                    }               
                    prevState = [`q${totalState}`, `q${totalState+1}`];
                    totalState+=2;
                }

            }



            
            if(prevState.length == 1) {
                document.getElementById(prevState[0]).innerHTML += `<div class="captionTop" id="caption1"></div>`;

                lines[lineIndex] = new LeaderLine(
                    document.getElementById(prevState[0]),
                    document.getElementById("caption1"), 
                    {startSocket: 'top', endSocket: 'left', path: 'arc', endPlug: 'behind', size: 2, color: 'black'}
                );
                lineIndex++;
                lines[lineIndex] = new LeaderLine(
                    document.getElementById("caption1"),
                    document.getElementById(prevState[0]), 
                    {startSocket: 'right', endSocket: 'top', path: 'arc', size: 2, color: 'black'}
                );
                lineIndex++;
                lines[lineIndex] = new LeaderLine(
                    document.getElementById(prevState[0]),
                    document.getElementById("caption1"), 
                    {startSocket: 'top', endSocket: 'top', size: 2, color: 'transparent', middleLabel: LeaderLine.captionLabel(loopText, {color: 'black', lineOffset: 100})}
                );
            }
            else {
                document.getElementById(prevState[0]).innerHTML += `<div class="captionTop" id="caption1"></div>`;
                document.getElementById(prevState[1]).innerHTML += `<div class="captionBottom" id="caption2"></div>`;

                lines[lineIndex] = new LeaderLine(
                    document.getElementById(prevState[0]),
                    document.getElementById("caption1"), 
                    {startSocket: 'top', endSocket: 'left', path: 'arc', endPlug: 'behind', size: 2, color: 'black'}
                );
                lineIndex++;
                lines[lineIndex] = new LeaderLine(
                    document.getElementById("caption1"),
                    document.getElementById(prevState[0]), 
                    {startSocket: 'right', endSocket: 'top', path: 'arc', size: 2, color: 'black'}
                );
                lineIndex++;
                lines[lineIndex] = new LeaderLine(
                    document.getElementById(prevState[0]),
                    document.getElementById("caption1"), 
                    {startSocket: 'top', endSocket: 'top', size: 2, color: 'transparent', middleLabel: LeaderLine.captionLabel(loopText, {color: 'black', lineOffset: 100})}
                );
                

                lines[lineIndex] = new LeaderLine(
                    document.getElementById(prevState[1]),
                    document.getElementById("caption2"), 
                    {startSocket: 'bottom', endSocket: 'left', path: 'arc', endPlug: 'behind', size: 2, color: 'black'}
                );
                lineIndex++;
                lines[lineIndex] = new LeaderLine(
                    document.getElementById("caption2"),
                    document.getElementById(prevState[1]), 
                    {startSocket: 'right', endSocket: 'bottom', path: 'arc', size: 2, color: 'black'}
                );
                lineIndex++;
                lines[lineIndex] = new LeaderLine(
                    document.getElementById(prevState[1]),
                    document.getElementById("caption2"), 
                    {startSocket: 'bottom', endSocket: 'bottom', size: 2, color: 'transparent', middleLabel: LeaderLine.captionLabel(loopText, {color: 'black', lineOffset: 100})}
                );
            }

            

            for(i=0; i<contain[maxContain].value.length; i++) {
                if(contain[0].value.charAt(i) == contain[1].value.charAt(i) || contain[0].value.charAt(i) == '' || contain[1].value.charAt(i) == '') {
                    result.innerHTML += `
                    <div class="stateContainer">
                        <div class="state" id="q${totalState}">
                            q<sub>${totalState}</sub>
                        </div>
                    </div>
                    `;
                    if(prevState.length == 1) {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(containString[maxContain].charAt(i))}
                        );
                        lineIndex++;
                    }
                    else {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(containString[maxContain].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[1]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(containString[maxContain].charAt(i))}
                        );
                        lineIndex++;
                    }
                    prevState = [`q${totalState}`];
                    totalState++;
                }
                else {
                    result.innerHTML += `
                    <div class="stateContainer">
                        <div class="state" id="q${totalState}">
                            q<sub>${totalState}</sub>
                        </div>
                        <div class="state" id="q${totalState+1}">
                            q<sub>${totalState+1}</sub>
                        </div>
                    </div>
                    `;

                    if(prevState.length == 1) {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(containString[0].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState+1}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(containString[1].charAt(i))}
                        );
                        lineIndex++;
                    }
                    else {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(containString[0].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[1]),
                            document.getElementById(`q${totalState+1}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(containString[1].charAt(i))}
                        );
                        lineIndex++;
                        if(i==0) {
                            lines[lineIndex] = new LeaderLine(
                                document.getElementById(prevState[1]),
                                document.getElementById(`q${totalState}`), 
                                {color: 'black', size: 2, path: 'straight', startLabel: LeaderLine.pathLabel(containString[0].charAt(i), {lineOffset: 10})}
                            );
                            lineIndex++;
                            lines[lineIndex] = new LeaderLine(
                                document.getElementById(prevState[0]),
                                document.getElementById(`q${totalState+1}`), 
                                {color: 'black', size: 2, path: 'straight', startLabel: LeaderLine.pathLabel(containString[1].charAt(i), {lineOffset: 10})}
                            );
                            lineIndex++;
                        }
                    }               
                    prevState = [`q${totalState}`, `q${totalState+1}`];
                    totalState+=2;
                }

            }

            


            if(contain[maxContain] !== 0) {
                if(prevState.length == 1) {
                    document.getElementById(prevState[0]).innerHTML += `<div class="captionTop" id="caption3"></div>`;

                    lines[lineIndex] = new LeaderLine(
                        document.getElementById(prevState[0]),
                        document.getElementById("caption3"), 
                        {startSocket: 'top', endSocket: 'left', path: 'arc', endPlug: 'behind', size: 2, color: 'black'}
                    );
                    lineIndex++;
                    lines[lineIndex] = new LeaderLine(
                        document.getElementById("caption3"),
                        document.getElementById(prevState[0]), 
                        {startSocket: 'right', endSocket: 'top', path: 'arc', size: 2, color: 'black'}
                    );
                    lineIndex++;
                    lines[lineIndex] = new LeaderLine(
                        document.getElementById(prevState[0]),
                        document.getElementById("caption3"), 
                        {startSocket: 'top', endSocket: 'top', size: 2, color: 'transparent', middleLabel: LeaderLine.captionLabel(loopText, {color: 'black', lineOffset: 100})}
                    );
                }
                else {
                    document.getElementById(prevState[0]).innerHTML += `<div class="captionTop" id="caption3"></div>`;
                    document.getElementById(prevState[1]).innerHTML += `<div class="captionBottom" id="caption4"></div>`;

                    lines[lineIndex] = new LeaderLine(
                        document.getElementById(prevState[0]),
                        document.getElementById("caption3"), 
                        {startSocket: 'top', endSocket: 'left', path: 'arc', endPlug: 'behind', size: 2, color: 'black'}
                    );
                    lineIndex++;
                    lines[lineIndex] = new LeaderLine(
                        document.getElementById("caption3"),
                        document.getElementById(prevState[0]), 
                        {startSocket: 'right', endSocket: 'top', path: 'arc', size: 2, color: 'black'}
                    );
                    lineIndex++;
                    lines[lineIndex] = new LeaderLine(
                        document.getElementById(prevState[0]),
                        document.getElementById("caption3"), 
                        {startSocket: 'top', endSocket: 'top', size: 2, color: 'transparent', middleLabel: LeaderLine.captionLabel(loopText, {color: 'black', lineOffset: 100})}
                    );
                    

                    lines[lineIndex] = new LeaderLine(
                        document.getElementById(prevState[1]),
                        document.getElementById("caption4"), 
                        {startSocket: 'bottom', endSocket: 'left', path: 'arc', endPlug: 'behind', size: 2, color: 'black'}
                    );
                    lineIndex++;
                    lines[lineIndex] = new LeaderLine(
                        document.getElementById("caption4"),
                        document.getElementById(prevState[1]), 
                        {startSocket: 'right', endSocket: 'bottom', path: 'arc', size: 2, color: 'black'}
                    );
                    lineIndex++;
                    lines[lineIndex] = new LeaderLine(
                        document.getElementById(prevState[1]),
                        document.getElementById("caption4"), 
                        {startSocket: 'bottom', endSocket: 'bottom', size: 2, color: 'transparent', middleLabel: LeaderLine.captionLabel(loopText, {color: 'black', lineOffset: 100})}
                    );
                }
            }

            for(i=0; i<end[maxEnd].value.length; i++) {
                if(end[0].value.charAt(i) == end[1].value.charAt(i) || end[0].value.charAt(i) == '' || end[1].value.charAt(i) == '') {
                    result.innerHTML += `
                    <div class="stateContainer">
                        <div class="state" id="q${totalState}">
                            q<sub>${totalState}</sub>
                        </div>
                    </div>
                    `;
                    if(prevState.length == 1) {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(endString[maxEnd].charAt(i))}
                        );
                        lineIndex++;
                    }
                    else {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(endString[maxEnd].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[1]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(endString[maxEnd].charAt(i))}
                        );
                        lineIndex++;
                    }
                    prevState = [`q${totalState}`];
                    totalState++;
                }
                else {
                    result.innerHTML += `
                    <div class="stateContainer">
                        <div class="state" id="q${totalState}">
                            q<sub>${totalState}</sub>
                        </div>
                        <div class="state" id="q${totalState+1}">
                            q<sub>${totalState+1}</sub>
                        </div>
                    </div>
                    `;

                    if(prevState.length == 1) {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(endString[0].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState+1}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(endString[1].charAt(i))}
                        );
                        lineIndex++;
                    }
                    else {
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[0]),
                            document.getElementById(`q${totalState}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(endString[0].charAt(i))}
                        );
                        lineIndex++;
                        lines[lineIndex] = new LeaderLine(
                            document.getElementById(prevState[1]),
                            document.getElementById(`q${totalState+1}`), 
                            {color: 'black', size: 2, path: 'straight', middleLabel: LeaderLine.pathLabel(endString[1].charAt(i))}
                        );
                        lineIndex++;
                        if(i==0) {
                            lines[lineIndex] = new LeaderLine(
                                document.getElementById(prevState[1]),
                                document.getElementById(`q${totalState}`), 
                                {color: 'black', size: 2, path: 'straight', startLabel: LeaderLine.pathLabel(endString[0].charAt(i), {lineOffset: 10})}
                            );
                            lineIndex++;
                            lines[lineIndex] = new LeaderLine(
                                document.getElementById(prevState[0]),
                                document.getElementById(`q${totalState+1}`), 
                                {color: 'black', size: 2, path: 'straight', startLabel: LeaderLine.pathLabel(endString[1].charAt(i), {lineOffset: 10})}
                            );
                            lineIndex++;
                        }
                    }               
                    prevState = [`q${totalState}`, `q${totalState+1}`];
                    totalState+=2;
                }

            }


            totalState--;
            
            prevState.forEach(state => {
                document.getElementById(state).classList.add("final");
            });
        }
    </script>
</body>
</html>